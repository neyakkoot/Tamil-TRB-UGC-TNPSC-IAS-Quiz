<script type="text/javascript">
(async function(){

  // ЁЯФ╣ роХро┐роЯрпИроХрпНроХрпБроорпН ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛ JSON роХрпЛрокрпНрокрпБроХро│ро┐ройрпН рокроЯрпНроЯро┐ропро▓рпН
  const quizList = {
    "UGC_NET_TAMIL_II_2008.json": "UGC NET Tamil тАУ 2008",
    "Language_Origin_Quiz.json": "роорпКро┤ро┐ родрпЛро▒рпНро▒роорпН ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ (1тАУ20)",
    "TRB_Tamil_Grammar.json": "TRB тАУ родрооро┐ро┤рпН роЗро▓роХрпНроХрогроорпН родрпКроХрпБрокрпНрокрпБ"
  };

  // ЁЯФ╣ Dropdown роЙро░рпБро╡ро╛роХрпНроХрпБродро▓рпН
  const qWrap = document.getElementById('tv-quiz-wrap');
  const dropdown = document.createElement('select');
  dropdown.id = 'quizSelect';
  dropdown.style.cssText = "display:block;width:100%;margin-bottom:15px;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:1rem;font-weight:600;";

  const defaultOpt = document.createElement('option');
  defaultOpt.value = '';
  defaultOpt.textContent = 'ЁЯза родрпЗро░рпНро╡рпБ роЪрпЖропрпНропрпБроорпН ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родрпКроХрпБрокрпНрокрпБ';
  defaultOpt.disabled = true;
  defaultOpt.selected = true;
  dropdown.appendChild(defaultOpt);

  for (const [file, title] of Object.entries(quizList)) {
    const opt = document.createElement('option');
    opt.value = file;
    opt.textContent = title;
    dropdown.appendChild(opt);
  }

  // Quiz рокроХрпБродро┐ропро┐ройрпН роорпЗро▓рпЗ dropdown роЪрпЗро░рпНроХрпНроХ
  const quizContainer = document.getElementById('tv-quiz');
  qWrap.insertBefore(dropdown, quizContainer);

  // ЁЯФ╣ DOM references
  const progressEl = document.getElementById('tv-progress');
  const qEl = document.getElementById('tv-question');
  const optsEl = document.getElementById('tv-options');
  const feedbackEl = document.getElementById('tv-feedback');
  const nextBtn = document.getElementById('tv-next');
  const resultsEl = document.getElementById('tv-results');

  const labels = ['(роЕ)','(роЖ)','(роЗ)','(роИ)'];
  let quizData = [];
  let idx = 0, score = 0;

  // ЁЯФ╣ ро╡ро┐ройро╛роХрпНроХро│рпИ JSON-роЗро▓рпН роЗро░рпБроирпНродрпБ роПро▒рпНро▒рпБроорпН function
  async function loadQuiz(file) {
    progressEl.textContent = 'ро╡ро┐ройро╛роХрпНроХро│рпИ роПро▒рпНро▒рпБроХро┐ро▒родрпБ...';
    qEl.textContent = '';
    optsEl.innerHTML = '';
    feedbackEl.style.display = 'none';
    nextBtn.style.display = 'none';
    resultsEl.style.display = 'none';

    try {
      const res = await fetch(file, { cache: "no-cache" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      quizData = data.questions || data;
      idx = 0; score = 0;
      renderQuestion();
      console.log("тЬЕ Quiz loaded:", file, quizData.length);
    } catch (e) {
      progressEl.textContent = 'тЪая╕П ро╡ро┐ройро╛роХрпНроХро│рпИ роПро▒рпНро▒ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ.';
      console.error(e);
    }
  }

  // ЁЯФ╣ ро╡ро┐ройро╛ роХро╛рогрпНрокро┐роХрпНроХрпБроорпН function
  function renderQuestion() {
    const q = quizData[idx];
    progressEl.textContent = `ро╡ро┐ройро╛ ${idx+1} / ${quizData.length}`;
    qEl.textContent = q.question;
    optsEl.innerHTML = '';
    feedbackEl.style.display = 'none';
    nextBtn.style.display = 'none';
    resultsEl.style.display = 'none';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'option-btn';
      btn.style.cssText = "padding:12px;border-radius:8px;border:1px solid #ddd;background:#f9f9f9;text-align:left;cursor:pointer;font-size:1rem;";
      btn.innerHTML = `<strong style='margin-right:8px;'>${labels[i]}</strong> ${opt}`;
      btn.onclick = () => selectAnswer(i, btn);
      optsEl.appendChild(btn);
    });
  }

  // ЁЯФ╣ рокродро┐ро▓рпН родрпЗро░рпНро╡рпБ
  function selectAnswer(choice, btn) {
    const q = quizData[idx];
    const correct = q.answer;
    const buttons = optsEl.querySelectorAll('button');
    buttons.forEach(b => b.disabled = true);

    if (choice === correct) {
      score++;
      btn.style.background = "#e6f7e9";
      btn.style.borderColor = "#28a745";
    } else {
      btn.style.background = "#fdecea";
      btn.style.borderColor = "#dc3545";
      if (buttons[correct]) {
        buttons[correct].style.background = "#e6f7e9";
        buttons[correct].style.borderColor = "#28a745";
      }
    }

    feedbackEl.style.display = 'block';
    feedbackEl.innerHTML = (choice === correct
      ? '<span style="color:green;font-weight:700;">тЬЕ роЪро░ро┐ропро╛рой ро╡ро┐роЯрпИ!</span>'
      : '<span style="color:red;font-weight:700;">тЭМ родро╡ро▒ро╛рой ро╡ро┐роЯрпИ.</span>')
      + `<div style="margin-top:10px;font-size:0.95rem;color:#333;">${q.explanation}</div>`;

    nextBtn.style.display = 'block';
    nextBtn.textContent = (idx < quizData.length - 1) ? 'роЕроЯрпБродрпНрод ро╡ро┐ройро╛' : 'роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХро╛рогрпН';
  }

  // ЁЯФ╣ роЕроЯрпБродрпНрод ро╡ро┐ройро╛
  nextBtn.addEventListener('click', function(){
    idx++;
    if (idx < quizData.length) {
      renderQuestion();
      qWrap.scrollIntoView({behavior:'smooth'});
    } else {
      showResults();
    }
  });

  // ЁЯФ╣ роорпБроЯро┐ро╡рпБ
  function showResults() {
    qEl.style.display = 'none';
    optsEl.style.display = 'none';
    progressEl.style.display = 'none';
    feedbackEl.style.display = 'none';
    nextBtn.style.display = 'none';

    resultsEl.style.display = 'block';
    resultsEl.innerHTML = `
      <h3 style="color:#0a58ca;margin-bottom:6px;">ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роорпБроЯро┐роирпНродродрпБ!</h3>
      <div style="font-size:1.1rem;font-weight:700;margin-bottom:8px;">роородро┐рокрпНрокрпЖрогрпН: ${score} / ${quizData.length}</div>
      <div style="margin-bottom:12px;">роЪродро╡рпАродроорпН: <strong>${((score/quizData.length)*100).toFixed(1)}%</strong></div>
      <button id="tv-retry" style="padding:10px 14px;border-radius:8px;background:#28a745;color:#fff;border:none;font-weight:700;cursor:pointer;">роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХ</button>
    `;
    document.getElementById('tv-retry').onclick = () => {
      idx = 0; score = 0;
      qEl.style.display = ''; optsEl.style.display = ''; progressEl.style.display = '';
      renderQuestion();
      qWrap.scrollIntoView({behavior:'smooth'});
    };
  }

  // ЁЯФ╣ Dropdown рооро╛ро▒рпНро▒роорпН тАФ рокрпБродро┐роп quiz роПро▒рпНро▒рпБродро▓рпН
  dropdown.addEventListener('change', e => {
    const file = e.target.value;
    if (file) loadQuiz(file);
  });

})();
</script>
